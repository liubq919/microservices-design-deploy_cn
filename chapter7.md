## 重构巨石应用至服务

本章节本电子书的第七章。章节一介绍了微服务架构模式，讨论了使用微服务的优缺点。接下来的章节，讨论了微服务架构图的不同方面：使用API Gateway，进程间通信，服务发现，事件驱动的数据管理和微服务部署。本章节我们将讨论将巨石应用迁移到微服务的策略方案。

我希望这本电子书能让您充分了解微服务架构，它的优点和缺点，以及何时使用它。 也许微服务架构非常适合您的组织。

但是，您很可能正在处理一个大型的、复杂的巨石应用。你每天对开发与部署巨石应用的体验是缓慢与痛苦。微服务看起来是遥不可及的天堂。幸运的是，有一些策略可以用来摆脱巨石的地狱。在本篇中，我将会描述如何循序渐进的将巨石应用重构成一组微服务。

### 微服务重构概述

将巨石应用程序重构成微服务的过程是应用程序现代化的一种形式。这是开发人员几十年来一直在做的事情。因此，在将应用程序重构为微服务时，我们可以重用一些思想。

一种不应该使用的策略是“大爆炸（Big Bang）”重写。这就是当你将所有开发工作集中在从头开始构建基于微服务的新应用程序的时候。虽然听起来很吸引人，但它风险极大，很可能以失败而告终。正如Martin
Fowler所报道的那样，“大爆炸重写保证的唯一一件事就是大爆炸!”

你应该循序渐进的重构巨石应用，而不是大爆炸重写。以微服务的形式逐步添加新功能与创建现有功能的扩展 - 以互补的方式修改巨石程序，并同时运行微服务和修改后的巨石应用。随着时间的推移，巨石应用实现的功能数量逐渐缩小，直到它完全消失或者变成另一个微服务。这种策略类似于在汽车在高速公路上以每小时70英里的速度行驶的同时维修汽车 - 具有挑战性，但风险远低于尝试大爆炸重写。

Martin Fowler将这种应用程序现代化策略称为Strangler应用。这个名字来自在热带雨林中发现的绞杀藤（亦称 绞杀榕）。绞杀藤围绕着树成长，为了能吸收森林树冠上的阳光。有时，树死了，留下了树形
藤蔓。应用程序现代化遵循相同的模式。我们将围绕遗留应用构建一个由微服务组成的新应用，遗留应用程序将会收缩，甚至最终死亡。

让我们讨论下完成该重构的不同策略。

#### 策略一：停止挖掘